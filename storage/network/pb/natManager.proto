syntax = "proto3";

package net.pb;

enum NatMsgType {
    UnknownReq      = 0;
    BootStrapReg    = 1;
    KeepAlive       = 2;
    Connect         = 3;
    Ping            = 4;
    holeAck         = 5;
    error           = 20;
}

enum NatType{
    UnknownRES      = 0;
    NoNatDevice     = 1;
    BehindNat       = 2;
    CanBeNatServer  = 3;
    ToBeChecked     = 4;
}

message BootNatRegReq {
    string  nodeId      = 1;
    string  privatePort = 3;
    string  privateIp   = 2;
}

message BootNatRegRes {
    NatType natType    = 1;
    string  nodeId      = 2;
    string  publicIp    = 3;
    string  publicPort  = 4;
}

message NatConInvite {
    NbsAddr fromAddr    = 1;
    NbsAddr toAddr      = 2;
    string sessionId    = 3;
    int32  cType        = 4;
}

message NbsAddr{
    string networkId    = 1;
    bool canServer      = 2;
    string pubIp        = 3;
    int32  pubPort      = 4;
    string priIp        = 5;
    int32 priPort       = 6;
}

message NatKeepAlive {
    string nodeId = 1;
    string lAddr  = 2;
}

message NatPing {
    string ping  = 1;
    string pong  = 2;
    string nonce = 3;
    int32  TTL   = 4;
}

message HoleAck{
    string sessionId = 1;
}

message ErrorNotify{
    string errMsg = 1;
}

message NatRequest {
    NatMsgType msgType          = 1;
    BootNatRegReq BootRegReq    = 2;
    NatConInvite connReq        = 3;
    NatKeepAlive keepAlive      = 4;
    NatPing ping                = 5;
    HoleAck holeAck             = 6;
}

message response {
    NatMsgType msgType          = 1;
    BootNatRegRes BootRegRes    = 2;
    NatConInvite connRes        = 3;
    NatKeepAlive keepAlive      = 4;
    NatPing pong                = 5;
    ErrorNotify error           = 6;
}